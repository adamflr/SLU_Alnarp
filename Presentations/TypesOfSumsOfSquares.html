<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Types of Sums of Squares in R</title>

<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fhome%24%2Fadfl0001%2FMy%2520Documents%2FR%2Fwin%2Dlibrary%2F3%2E4%2Frmarkdown%2Frmd%2Fh%2Fjquery%2D1%2E11%2E3%2Fjquery%2Emin%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fhome%24%2Fadfl0001%2FMy%2520Documents%2FR%2Fwin%2Dlibrary%2F3%2E4%2Frmarkdown%2Frmd%2Fh%2Fbootstrap%2D3%2E3%2E5%2Fcss%2Fbootstrap%2Emin%2Ecss%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A" rel="stylesheet" />
<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fhome%24%2Fadfl0001%2FMy%2520Documents%2FR%2Fwin%2Dlibrary%2F3%2E4%2Frmarkdown%2Frmd%2Fh%2Fbootstrap%2D3%2E3%2E5%2Fjs%2Fbootstrap%2Emin%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>
<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fhome%24%2Fadfl0001%2FMy%2520Documents%2FR%2Fwin%2Dlibrary%2F3%2E4%2Frmarkdown%2Frmd%2Fh%2Fbootstrap%2D3%2E3%2E5%2Fshim%2Fhtml5shiv%2Emin%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>
<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fhome%24%2Fadfl0001%2FMy%2520Documents%2FR%2Fwin%2Dlibrary%2F3%2E4%2Frmarkdown%2Frmd%2Fh%2Fbootstrap%2D3%2E3%2E5%2Fshim%2Frespond%2Emin%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>
<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fhome%24%2Fadfl0001%2FMy%2520Documents%2FR%2Fwin%2Dlibrary%2F3%2E4%2Frmarkdown%2Frmd%2Fh%2Fnavigation%2D1%2E1%2Ftabsets%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>
<link href="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fhome%24%2Fadfl0001%2FMy%2520Documents%2FR%2Fwin%2Dlibrary%2F3%2E4%2Frmarkdown%2Frmd%2Fh%2Fhighlightjs%2Fdefault%2Ecss%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A" rel="stylesheet" />
<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fhome%24%2Fadfl0001%2FMy%2520Documents%2FR%2Fwin%2Dlibrary%2F3%2E4%2Frmarkdown%2Frmd%2Fh%2Fhighlightjs%2Fhighlight%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type="text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Types of Sums of Squares in R</h1>

</div>


<div id="types-of-ss" class="section level1">
<h1>Types of SS</h1>
<p>In unbalanced factorial designs, there is no clear decompositon of the total sum of square into parts explained by each factor. Commercial software has introduced a taxonomy of four types of possible decomposition methods.</p>
<p>This piece mainly concerns the difference between type II and type III, as those are the most common choices. Those types of sums of squares are perhaps best introduced by example.</p>
<p>We create a pseudo-random dataset with two binary factors <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>. A third variable <span class="math inline">\(A_B\)</span> is calculated as the indicator of <span class="math inline">\(A=B\)</span> and the response <span class="math inline">\(y\)</span> is created so that there is an effect of factor <span class="math inline">\(B\)</span> but not of factor <span class="math inline">\(A\)</span> or the interaction.</p>
<pre class="r"><code>  set.seed(8)
.a &lt;- data.frame(A = sample(0:1, 100, T),
                 B = sample(0:1, 100, T))
.a$A_B &lt;- as.numeric(.a$A == .a$B)
.a$y &lt;- .a$B + rnorm(100)
for(i in 1:3) {.a[, i] &lt;- factor(.a[, i])}

head(.a)</code></pre>
<pre><code>##   A B A_B          y
## 1 0 1   0  1.2968513
## 2 0 0   1 -1.9005736
## 3 1 0   0 -1.6473656
## 4 1 0   0 -1.7784054
## 5 0 1   0  1.0349434
## 6 1 1   1  0.5054536</code></pre>
<p>Next, some different possible models are estimated and the SSE calculated. The anova table with type II sums of squares is calculated using the Anova function in the car package.</p>
<pre class="r"><code>  sum(residuals(lm(y ~ A, .a))^2)</code></pre>
<pre><code>## [1] 132.1466</code></pre>
<pre class="r"><code>sum(residuals(lm(y ~ B, .a))^2)</code></pre>
<pre><code>## [1] 112.7595</code></pre>
<pre class="r"><code>sum(residuals(lm(y ~ A + B, .a))^2)</code></pre>
<pre><code>## [1] 111.8651</code></pre>
<pre class="r"><code>sum(residuals(lm(y ~ A + B + A_B, .a))^2)</code></pre>
<pre><code>## [1] 110.0759</code></pre>
<pre class="r"><code>library(car)

Anova(lm(y ~ A * B, .a), type = 2)</code></pre>
<pre><code>## Anova Table (Type II tests)
## 
## Response: y
##            Sum Sq Df F value    Pr(&gt;F)    
## A           0.894  1  0.7800    0.3793    
## B          20.282  1 17.6880 5.848e-05 ***
## A:B         1.789  1  1.5604    0.2146    
## Residuals 110.076 96                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>We can now identify the calculation of the sums of squares: <span class="math inline">\(SS_{A}\)</span> is the decrease in <span class="math inline">\(SSE\)</span> when the model with factor A and factor B is compared to the model with only factor B; SS_B is similar; <span class="math inline">\(SS_{A\_B}\)</span> is the decrease in <span class="math inline">\(SSE\)</span> when the full-factorial model is compared to the model with factor A and factor B.</p>
<p>We make a similar calculation demonstrating sums of squares of type III. Note that specific contrasts must be set in order to get correct results from the Anova function.</p>
<pre class="r"><code>  sum(residuals(lm(y ~ A + A_B, .a))^2)</code></pre>
<pre><code>## [1] 130.8381</code></pre>
<pre class="r"><code>sum(residuals(lm(y ~ B + A_B, .a))^2)</code></pre>
<pre><code>## [1] 111.0342</code></pre>
<pre class="r"><code>sum(residuals(lm(y ~ A + B, .a))^2)</code></pre>
<pre><code>## [1] 111.8651</code></pre>
<pre class="r"><code>sum(residuals(lm(y ~ A + B + A_B, .a))^2)</code></pre>
<pre><code>## [1] 110.0759</code></pre>
<pre class="r"><code>Anova(lm(y ~ A * B, .a, 
         contrasts = list(A = contr.sum,
                          B = contr.sum)), 
      type = 3)</code></pre>
<pre><code>## Anova Table (Type III tests)
## 
## Response: y
##              Sum Sq Df F value    Pr(&gt;F)    
## (Intercept)  23.424  1 20.4287 1.766e-05 ***
## A             0.958  1  0.8358    0.3629    
## B            20.762  1 18.1072 4.857e-05 ***
## A:B           1.789  1  1.5604    0.2146    
## Residuals   110.076 96                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>So the SS type III is the decrease in SSE when the interaction model is compared to a model where the factor of interest has been dropped.</p>
<p>These examples generalize to models with more factors with more factor levels.</p>
<div id="the-case-for-type-iii" class="section level2">
<h2>The Case for Type III</h2>
</div>
<div id="the-case-for-type-ii" class="section level2">
<h2>The Case for Type II</h2>
<p>The main advantage of SS type II must be the greater power for main effects, in comparison to type III. A simple example in an unbalanced design is given below. The p-value of the F-test differs greatly between SS type II and SS type III. In the type III case, the main effect is underestimated because of confounding with the interaction effect.</p>
<pre class="r"><code>  set.seed(6)
.a &lt;- data.frame(A = c(rep(0, 5), rep(0, 5), 
                       rep(1, 50), rep(1, 50)),
                 B = c(rep(0, 5), rep(1, 5), 
                       rep(0, 50), rep(1, 50)))
.a$y &lt;- .a$B + rnorm(dim(.a)[1], sd = 1)
.a$AB &lt;- .a$A == .a$B + 0
with(.a, table(A,B))</code></pre>
<pre><code>##    B
## A    0  1
##   0  5  5
##   1 50 50</code></pre>
<pre class="r"><code>.a$A &lt;- factor(.a$A)
.a$B &lt;- factor(.a$B)

mod &lt;- lm(y ~ A * B, .a, 
          contrasts = list(A = contr.sum, B = contr.sum))

Anova(mod, type = 2)</code></pre>
<pre><code>## Anova Table (Type II tests)
## 
## Response: y
##            Sum Sq  Df F value    Pr(&gt;F)    
## A           0.221   1  0.2188    0.6409    
## B          17.693   1 17.5511 5.804e-05 ***
## A:B         0.675   1  0.6691    0.4152    
## Residuals 106.858 106                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<pre class="r"><code>Anova(mod, type = 3)</code></pre>
<pre><code>## Anova Table (Type III tests)
## 
## Response: y
##              Sum Sq  Df F value   Pr(&gt;F)   
## (Intercept)  10.117   1 10.0361 0.002006 **
## A             0.221   1  0.2188 0.640911   
## B             3.050   1  3.0257 0.084856 . 
## A:B           0.675   1  0.6691 0.415193   
## Residuals   106.858 106                    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
